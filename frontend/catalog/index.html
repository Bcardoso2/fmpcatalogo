<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMP REPASSES - Cat√°logo Premium</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --green-50: #ecfdf5;
            --green-100: #d1fae5;
            --green-200: #a7f3d0;
            --green-500: #10b981;
            --green-600: #059669;
            --green-700: #047857;
            --green-800: #0d5c3d;
            --green-900: #064e3b;
            
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-600: #475569;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 28px;
            --radius-xl: 36px;
        }
        
        body { 
            font-family: 'Outfit', system-ui, -apple-system, sans-serif;
            background: var(--slate-50);
            color: var(--slate-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .hidden { display: none !important; }
        
        /* HEADER ULTRA PREMIUM */
        .header {
            background: linear-gradient(180deg, #000000 0%, #0a2015 100%);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: radial-gradient(ellipse at top, rgba(16, 185, 129, 0.15), transparent 70%);
            pointer-events: none;
        }
        
        .header-wrap {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem 3rem;
            position: relative;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            text-decoration: none;
        }
        
        .brand-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-700) 100%);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: white;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .brand-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .brand-text {
            display: flex;
            flex-direction: column;
        }
        
        .brand-name {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, var(--green-200) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }
        
        .brand-tagline {
            font-size: 0.875rem;
            color: var(--green-300);
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-chip {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 100px;
            padding: 0.875rem 1.75rem;
        }
        
        .user-name {
            color: white;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .credits-pill {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            padding: 0.5rem 1.25rem;
            border-radius: 100px;
            font-weight: 800;
            font-size: 0.9375rem;
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 100px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 0.9375rem;
        }

        .logout-btn:hover {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
            transform: translateY(-2px);
        }

        .login-btn {
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-700) 100%);
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 100px;
            font-weight: 800;
            text-decoration: none;
            font-size: 1rem;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(16, 185, 129, 0.4);
        }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-item {
            padding: 0.875rem 2rem;
            border-radius: 100px;
            text-decoration: none;
            color: rgba(255,255,255,0.6);
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s;
            border: 1px solid transparent;
            position: relative;
        }

        .nav-item:hover, .nav-item.active {
            color: white;
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
        }

        .metrics {
            display: flex;
            justify-content: center;
            gap: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, white 0%, var(--green-200) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
            line-height: 1;
            margin-bottom: 0.625rem;
        }

        .metric-label {
            font-size: 0.8125rem;
            color: var(--green-300);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* CONTAINER */
        .wrap {
            max-width: 1600px;
            margin: 0 auto;
            padding: 4rem 3rem;
        }

        /* LOADING */
        .loader {
            text-align: center;
            padding: 8rem 2rem;
        }

        .spinner {
            width: 64px;
            height: 64px;
            border: 6px solid var(--slate-200);
            border-top-color: var(--green-600);
            border-radius: 50%;
            animation: rotate 0.8s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        /* FILTERS PREMIUM */
        .filter-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: 3rem;
            margin-bottom: 4rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 20px 40px rgba(0,0,0,0.03);
            border: 1px solid var(--slate-200);
        }

        .search-box {
            position: relative;
            margin-bottom: 2.5rem;
        }

        .search-input {
            width: 100%;
            padding: 1.5rem 2rem 1.5rem 5rem;
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: 100px;
            font-size: 1.125rem;
            font-family: inherit;
            font-weight: 600;
            color: var(--slate-900);
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--green-600);
            background: white;
            box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.1);
        }

        .search-input::placeholder {
            color: var(--slate-400);
        }

        .search-ico {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: var(--green-600);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
        }

        .dropdown {
            padding: 1.25rem 1.75rem;
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: inherit;
            font-weight: 700;
            color: var(--slate-900);
            cursor: pointer;
            transition: all 0.3s;
        }

        .dropdown:focus {
            outline: none;
            border-color: var(--green-600);
            background: white;
            box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.1);
        }

        .summary {
            background: linear-gradient(135deg, var(--green-50) 0%, var(--slate-50) 100%);
            border: 2px solid var(--green-200);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-top: 2.5rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.0625rem;
            color: var(--green-800);
        }

        .summary strong {
            font-weight: 900;
            color: var(--green-700);
        }

        /* EVENT BANNER */
        .event-block {
            margin-bottom: 5rem;
        }

        .event-head {
            background: linear-gradient(135deg, var(--green-800) 0%, var(--green-900) 100%);
            border-radius: var(--radius-lg);
            padding: 2.5rem 3rem;
            margin-bottom: 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(13, 92, 61, 0.3);
            position: relative;
            overflow: hidden;
        }

        .event-head::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.2), transparent 70%);
            border-radius: 50%;
        }

        .event-title {
            font-size: 2.25rem;
            font-weight: 900;
            color: white;
            position: relative;
            z-index: 1;
        }

        .event-count {
            background: white;
            color: var(--green-800);
            padding: 1rem 2rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 1.5rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        /* GRID PREMIUM */
        .vehicle-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2.5rem;
        }

        .v-card {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 1px solid var(--slate-200);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .v-card:hover {
            transform: translateY(-16px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.12);
            border-color: var(--green-600);
        }

        /* IMAGE SECTION */
        .img-zone {
            position: relative;
            height: 400px;
            background: linear-gradient(135deg, var(--slate-100) 0%, var(--slate-200) 100%);
        }

        .main-img {
            position: relative;
            height: 340px;
            cursor: pointer;
            overflow: hidden;
        }

        .main-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .v-card:hover .main-img img {
            transform: scale(1.15) rotate(2deg);
        }

        .img-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(13, 92, 61, 0.95) 0%, rgba(6, 78, 59, 0.98) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s;
        }

        .main-img:hover .img-overlay {
            opacity: 1;
        }

        .zoom-ico {
            font-size: 4rem;
            color: white;
            margin-bottom: 1rem;
        }

        .zoom-label {
            color: white;
            font-size: 1.25rem;
            font-weight: 800;
        }

        .thumb-bar {
            display: flex;
            height: 60px;
            gap: 8px;
            padding: 8px;
            background: rgba(0,0,0,0.03);
        }

        .thumb-img {
            flex: 1;
            height: 44px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .thumb-img:hover {
            border-color: var(--green-600);
            transform: scale(1.1);
        }

        .more-thumb {
            flex: 1;
            height: 44px;
            background: var(--green-50);
            border: 3px solid var(--green-600);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: var(--green-700);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .more-thumb:hover {
            background: var(--green-600);
            color: white;
            transform: scale(1.1);
        }

        .no-img {
            height: 400px;
            background: linear-gradient(135deg, var(--slate-100) 0%, var(--slate-200) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .no-img-ico {
            font-size: 5rem;
            color: var(--slate-300);
            margin-bottom: 1.5rem;
        }

        .no-img-txt {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--slate-400);
        }

        /* CARD BODY */
        .v-body {
            padding: 3rem;
        }

        .v-head {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            gap: 2rem;
        }

        .v-info {
            flex: 1;
        }

        .v-name {
            font-size: 2rem;
            font-weight: 900;
            color: var(--slate-900);
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .year-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--green-50) 0%, var(--green-100) 100%);
            color: var(--green-800);
            padding: 0.625rem 1.5rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 1rem;
            border: 2px solid var(--green-200);
        }

        .v-tags {
            display: flex;
            flex-direction: column;
            gap: 0.875rem;
        }

        .cat-tag {
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-800) 100%);
            color: white;
            padding: 0.75rem 1.75rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 0.9375rem;
            text-align: center;
            box-shadow: 0 6px 20px rgba(13, 92, 61, 0.3);
            white-space: nowrap;
        }

        .price-card {
            background: linear-gradient(135deg, var(--green-50) 0%, white 100%);
            border: 3px solid var(--green-200);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .price-amt {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-800) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }

        .spec-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .spec-tag {
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            padding: 0.875rem 1.5rem;
            border-radius: 100px;
            font-weight: 800;
            font-size: 0.9375rem;
            color: var(--slate-700);
        }

        .loc-info {
            color: var(--slate-500);
            font-weight: 700;
            font-size: 1.0625rem;
            margin-bottom: 2rem;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem;
        }

        .btn-group .cta-btn {
            grid-column: 1 / -1;
        }

        .btn {
            padding: 1.25rem 2rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 900;
            font-size: 1.0625rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            text-align: center;
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-800) 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(13, 92, 61, 0.3);
        }

        .primary-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(13, 92, 61, 0.4);
        }

        .secondary-btn {
            background: var(--slate-50);
            color: var(--green-700);
            border: 2px solid var(--slate-200);
            font-weight: 800;
        }

        .secondary-btn:hover {
            background: white;
            border-color: var(--green-600);
            color: var(--green-700);
        }

        .cta-btn {
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-700) 100%);
            color: white;
            font-size: 1.25rem;
            box-shadow: 0 8px 28px rgba(16, 185, 129, 0.35);
        }

        .cta-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 36px rgba(16, 185, 129, 0.45);
        }

        .warn-btn {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.3);
        }

        .warn-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
        }

        /* MODAL */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(16px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .dialog {
            background: white;
            border-radius: var(--radius-xl);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.4s;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
        }

        /* Modal maior para galeria */
        .dialog.gallery-dialog {
            max-width: 1200px;
        }

        .overlay.show .dialog {
            transform: scale(1);
        }

        .dialog-head {
            padding: 3rem;
            border-bottom: 1px solid var(--slate-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--slate-50);
        }

        .dialog-title {
            font-size: 2.25rem;
            font-weight: 900;
            color: var(--green-800);
        }

        .close-btn {
            width: 52px;
            height: 52px;
            background: white;
            border: 2px solid var(--slate-200);
            border-radius: var(--radius-sm);
            font-size: 2rem;
            font-weight: 900;
            color: var(--slate-400);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: var(--slate-100);
            color: var(--slate-600);
        }

        .dialog-body {
            padding: 3rem;
        }

        .field {
            margin-bottom: 2rem;
        }

        .field-label {
            display: block;
            font-weight: 900;
            font-size: 1.0625rem;
            color: var(--slate-900);
            margin-bottom: 1rem;
        }

        .field-input {
            width: 100%;
            padding: 1.25rem 1.75rem;
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: var(--radius-md);
            font-size: 1.0625rem;
            font-family: inherit;
            font-weight: 700;
            color: var(--slate-900);
            transition: all 0.3s;
        }

        .field-input:focus {
            outline: none;
            border-color: var(--green-600);
            background: white;
            box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.1);
        }

        .alert-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 3px solid #fbbf24;
            border-radius: var(--radius-md);
            padding: 2rem;
            margin: 2.5rem 0;
            font-weight: 700;
            font-size: 1rem;
            color: #92400e;
            line-height: 1.7;
        }

        /* TOAST */
        #toastWrap {
            position: fixed;
            top: 2.5rem;
            right: 2.5rem;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: var(--radius-md);
            padding: 1.75rem 2.5rem;
            margin-bottom: 1.25rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: slideToast 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 360px;
            font-weight: 800;
            font-size: 1.0625rem;
        }

        @keyframes slideToast {
            from { transform: translateX(500px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success {
            border-left: 8px solid var(--green-600);
            color: var(--green-700);
        }

        .toast.error {
            border-left: 8px solid #ef4444;
            color: #dc2626;
        }

        /* GALERIA COM THUMBNAILS SELECION√ÅVEIS */
        .main-photo-viewer {
            width: 100%;
            background: #000;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 1.5rem;
            position: relative;
            min-height: 50vh;
            max-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-photo-viewer img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .photo-counter-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 1rem;
        }

        .thumbnails-section h5 {
            font-size: 1rem;
            font-weight: 900;
            color: var(--green-800);
            margin-bottom: 1rem;
        }

        .thumbnails-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            max-height: 250px;
            overflow-y: auto;
            padding: 0.75rem;
            background: var(--slate-50);
            border-radius: var(--radius-md);
        }

        .thumbnail-box {
            aspect-ratio: 16/9;
            border-radius: var(--radius-sm);
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .thumbnail-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-box:active {
            transform: scale(0.95);
        }

        .thumbnail-box.active {
            border-color: var(--green-600);
            box-shadow: 0 0 0 3px var(--green-200);
        }

        .thumbnail-box.active::after {
            content: '‚úì';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--green-600);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.875rem;
        }

        @media (min-width: 640px) {
            .thumbnails-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .thumbnails-container {
                grid-template-columns: repeat(4, 1fr);
            }

            .thumbnail-box:hover {
                border-color: var(--green-400);
                transform: scale(1.05);
            }
        }

        /* GALLERY MODAL STYLES */
        .gallery-modal {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .main-photo-container {
            width: 100%;
            background: var(--slate-900);
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            max-height: 70vh;
            position: relative;
        }

        .main-photo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            cursor: zoom-in;
        }

        .photo-counter {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 1rem;
        }

        .thumbnails-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            max-height: 200px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .thumbnail-item {
            aspect-ratio: 16/9;
            border-radius: var(--radius-sm);
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .thumbnail-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-item:hover {
            border-color: var(--green-400);
            transform: scale(1.05);
        }

        .thumbnail-item.active {
            border-color: var(--green-600);
            box-shadow: 0 0 0 2px var(--green-200);
        }

        .thumbnail-item.active::after {
            content: '‚úì';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--green-600);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.875rem;
        }

        /* MOBILE ADJUSTMENTS FOR GALLERY */
        @media (max-width: 639px) {
            .thumbnails-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-photo-container {
                min-height: 40vh;
                max-height: 50vh;
            }
        }

        @media (min-width: 640px) {
            .thumbnails-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .thumbnails-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        /* MOBILE FIRST - BASE STYLES */
        .header-wrap {
            padding: 1.5rem 1rem;
        }

        .brand-icon {
            width: 48px;
            height: 48px;
            font-size: 1.5rem;
        }

        .brand-name {
            font-size: 1.25rem;
        }

        .brand-tagline {
            font-size: 0.75rem;
        }

        .nav-bar {
            flex-direction: column;
            gap: 0.75rem;
        }

        .nav-item {
            width: 100%;
            text-align: center;
        }

        .metrics {
            flex-direction: column;
            gap: 1.5rem;
        }

        .wrap {
            padding: 2rem 1rem;
        }

        .filter-panel {
            padding: 1.5rem;
        }

        .search-input {
            padding: 1rem 1rem 1rem 3.5rem;
            font-size: 1rem;
        }

        .search-ico {
            left: 1rem;
            font-size: 1.25rem;
        }

        .filter-row {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .event-head {
            padding: 1.5rem;
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }

        .event-title {
            font-size: 1.5rem;
        }

        .vehicle-grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .v-body {
            padding: 1.5rem;
        }

        .v-name {
            font-size: 1.5rem;
        }

        .price-amt {
            font-size: 2rem;
        }

        .btn-group {
            grid-template-columns: 1fr;
        }

        .user-chip {
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
        }

        .header-right {
            flex-direction: column;
            width: 100%;
        }

        .login-btn {
            width: 100%;
            text-align: center;
        }

        /* TABLET - 640px+ */
        @media (min-width: 640px) {
            .header-wrap {
                padding: 2rem 2rem;
            }

            .brand-icon {
                width: 56px;
                height: 56px;
                font-size: 1.75rem;
            }

            .brand-name {
                font-size: 1.75rem;
            }

            .nav-bar {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .nav-item {
                width: auto;
            }

            .filter-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .event-head {
                flex-direction: row;
                text-align: left;
            }

            .vehicle-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn-group {
                grid-template-columns: 1fr 1fr;
            }

            .header-right {
                flex-direction: row;
                width: auto;
            }

            .login-btn {
                width: auto;
            }
        }

        /* DESKTOP SMALL - 1024px+ */
        @media (min-width: 1024px) {
            .header-wrap {
                padding: 2rem 3rem;
            }

            .brand-icon {
                width: 64px;
                height: 64px;
                font-size: 2rem;
            }

            .brand-name {
                font-size: 2rem;
            }

            .metrics {
                flex-direction: row;
                gap: 3rem;
            }

            .wrap {
                padding: 4rem 3rem;
            }

            .filter-panel {
                padding: 3rem;
            }

            .filter-row {
                grid-template-columns: repeat(3, 1fr);
            }

            .vehicle-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .v-body {
                padding: 3rem;
            }

            .v-name {
                font-size: 2rem;
            }

            .price-amt {
                font-size: 3rem;
            }
        }

        /* DESKTOP LARGE - 1280px+ */
        @media (min-width: 1280px) {
            .filter-row {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
        }

        /* DESKTOP XL - 1600px+ */
        @media (min-width: 1600px) {
            .vehicle-grid {
                grid-template-columns: repeat(auto-fill, minmax(480px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="toastWrap"></div>

    <header class="header">
        <div class="header-wrap">
            <div class="top-bar">
                <a href="/" class="brand">
                    <div class="brand-icon">F</div>
                    <div class="brand-text">
                        <div class="brand-name">FMP REPASSES</div>
                        <div class="brand-tagline">Ve√≠culos Premium</div>
                    </div>
                </a>

                <div class="header-right">
                    <div class="user-chip hidden" id="userChip">
                        <span class="user-name" id="userName"></span>
                        <span class="credits-pill" id="userCredits">0 cr√©ditos</span>
                        <button class="logout-btn" onclick="logout()">Sair</button>
                    </div>
                    <a href="login" class="login-btn" id="loginBtn">Entrar Agora</a>
                </div>
            </div>

            <nav class="nav-bar" id="navBar">
                <a href="/" class="nav-item active">Cat√°logo</a>
                <a href="propostas" class="nav-item">Minhas Propostas</a>
                <a href="recarga" class="nav-item">Recarregar</a>
                <a href="perfil" class="nav-item">Meu Perfil</a>
            </nav>

            <div class="metrics">
                <div class="metric">
                    <span class="metric-value" id="totalVehicles">0</span>
                    <span class="metric-label">Ve√≠culos</span>
                </div>
            </div>
        </div>
    </header>

    <div class="wrap">
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p style="font-weight: 800; color: var(--slate-400); font-size: 1.375rem;">Carregando cat√°logo...</p>
        </div>

        <div id="catalog" class="hidden">
            <div class="filter-panel">
                <div class="search-box">
                    <div class="search-ico">üîç</div>
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar ve√≠culos por marca ou modelo...">
                </div>

                <div class="filter-row">
                    <select class="dropdown" id="categoryFilter">
                        <option value="all">üì¶ Todas as Categorias</option>
                    </select>

                    <select class="dropdown" id="stateFilter">
                        <option value="all">üìç Todos os Estados</option>
                    </select>

                    <select class="dropdown" id="eventFilter">
                        <option value="all">üìÖ Todos os Eventos</option>
                    </select>

                    <select class="dropdown" id="priceFilter">
                        <option value="all">üí∞ Todos os Pre√ßos</option>
                        <option value="0-10000">At√© R$ 10.000</option>
                        <option value="10000-20000">R$ 10.000 - R$ 20.000</option>
                        <option value="20000-30000">R$ 20.000 - R$ 30.000</option>
                        <option value="30000-50000">R$ 30.000 - R$ 50.000</option>
                        <option value="50000-100000">R$ 50.000 - R$ 100.000</option>
                        <option value="100000-999999999">Acima de R$ 100.000</option>
                    </select>

                    <select class="dropdown" id="sortFilter">
                        <option value="none">üîÑ Ordenar por</option>
                        <option value="price-asc">Menor Pre√ßo</option>
                        <option value="price-desc">Maior Pre√ßo</option>
                        <option value="year-desc">Ano (Mais Novo)</option>
                        <option value="year-asc">Ano (Mais Antigo)</option>
                        <option value="km-asc">Menor KM</option>
                        <option value="km-desc">Maior KM</option>
                    </select>
                </div>

                <div class="summary">
                    Exibindo <strong id="visibleCount">0</strong> de <strong id="totalCount">0</strong> ve√≠culos dispon√≠veis
                </div>
            </div>

            <div id="vehiclesGrid"></div>
        </div>
    </div>

    <script>
        const APP_STATE = {
            vehicles: [],
            currentUser: null,
            isLoggedIn: false
        }

        const API_BASE = window.location.origin + '/api'

        async function loadVehicles() {
            try {
                const res = await fetch(`${API_BASE}/vehicles`, { credentials: 'include' })
                const data = await res.json()

                if (data.success) {
                    APP_STATE.vehicles = data.vehicles
                    populateFilters()
                    renderVehicles()
                    updateStats()
                } else {
                    toast('Erro ao carregar ve√≠culos', 'error')
                }
            } catch (err) {
                console.error(err)
                toast('Erro de conex√£o', 'error')
            } finally {
                document.getElementById('loader').classList.add('hidden')
                document.getElementById('catalog').classList.remove('hidden')
            }
        }

        async function checkAuth() {
            try {
                const res = await fetch(`${API_BASE}/auth/me`, { credentials: 'include' })
                const data = await res.json()

                if (data.success && data.user) {
                    APP_STATE.currentUser = data.user
                    APP_STATE.isLoggedIn = true
                }

                updateUI()
            } catch (err) {
                updateUI()
            }
        }

        function updateUI() {
            const chip = document.getElementById('userChip')
            const btn = document.getElementById('loginBtn')
            const nav = document.getElementById('navBar')

            if (APP_STATE.isLoggedIn && APP_STATE.currentUser) {
                chip.classList.remove('hidden')
                btn.classList.add('hidden')
                nav.classList.remove('hidden')
                document.getElementById('userName').textContent = APP_STATE.currentUser.name
                document.getElementById('userCredits').textContent = `${parseFloat(APP_STATE.currentUser.credits).toFixed(1)} cr√©ditos`
            } else {
                chip.classList.add('hidden')
                btn.classList.remove('hidden')
                nav.classList.add('hidden')
            }
        }

        function populateFilters() {
            const catF = document.getElementById('categoryFilter')
            const staF = document.getElementById('stateFilter')
            const evtF = document.getElementById('eventFilter')

            const cats = [...new Set(APP_STATE.vehicles.map(v => v.vehicle_data?.vehicle?.category_name).filter(Boolean))].sort()
            const stas = [...new Set(APP_STATE.vehicles.map(v => v.vehicle_data?.shop_stock?.state).filter(Boolean))].sort()
            const evts = [...new Set(APP_STATE.vehicles.map(v => {
                const fd = v.vehicle_data?.negotiation?.finish_date_display
                return fd ? fd.split(' ')[0] : null
            }).filter(Boolean))].sort((a,b) => new Date(b) - new Date(a))

            cats.forEach(c => {
                const o = document.createElement('option')
                o.value = c
                o.textContent = c
                catF.appendChild(o)
            })

            stas.forEach(s => {
                const o = document.createElement('option')
                o.value = s
                o.textContent = s
                staF.appendChild(o)
            })

            evts.forEach(e => {
                const [y,m,d] = e.split('-')
                const o = document.createElement('option')
                o.value = e
                o.textContent = `${d}/${m}/${y}`
                evtF.appendChild(o)
            })
        }

        function renderVehicles() {
            const grid = document.getElementById('vehiclesGrid')
            grid.innerHTML = ''

            let filtered = [...APP_STATE.vehicles]

            const catF = document.getElementById('categoryFilter').value
            const staF = document.getElementById('stateFilter').value
            const evtF = document.getElementById('eventFilter').value

            if (catF !== 'all') filtered = filtered.filter(v => v.vehicle_data?.vehicle?.category_name === catF)
            if (staF !== 'all') filtered = filtered.filter(v => v.vehicle_data?.shop_stock?.state === staF)
            if (evtF !== 'all') filtered = filtered.filter(v => {
                const fd = v.vehicle_data?.negotiation?.finish_date_display
                return fd && fd.split(' ')[0] === evtF
            })

            const grouped = {}
            filtered.forEach(v => {
                const fd = v.vehicle_data?.negotiation?.finish_date_display
                const dt = fd ? fd.split(' ')[0] : 'no-date'
                if (!grouped[dt]) grouped[dt] = []
                grouped[dt].push(v)
            })

            const sorted = Object.keys(grouped).sort((a,b) => {
                if (a === 'no-date') return 1
                if (b === 'no-date') return -1
                return new Date(b) - new Date(a)
            })

            sorted.forEach(dt => {
                const sec = document.createElement('div')
                sec.className = 'event-block'

                let fmt
                if (dt === 'no-date') {
                    fmt = 'Sem Data Definida'
                } else {
                    const [y,m,d] = dt.split('-')
                    fmt = `${d}/${m}/${y}`
                }

                sec.innerHTML = `
                    <div class="event-head">
                        <h2 class="event-title">Evento: ${fmt}</h2>
                        <div class="event-count">${grouped[dt].length}</div>
                    </div>
                    <div class="vehicle-grid" id="grid-${dt}"></div>
                `

                grid.appendChild(sec)

                const subgrid = document.getElementById(`grid-${dt}`)
                grouped[dt].forEach(v => {
                    const idx = APP_STATE.vehicles.indexOf(v)
                    subgrid.appendChild(buildCard(v, idx))
                })
            })

            updateVisible(filtered.length)
        }

        function buildCard(v, idx) {
            const card = document.createElement('div')
            card.className = 'v-card'
            card.setAttribute('data-index', idx)

            const imgs = v.images || []
            const hasImgs = imgs.length > 0

            card.innerHTML = `
                <div class="img-zone">
                    ${hasImgs ? `
                        <div class="main-img" onclick="viewGallery(${idx})">
                            <img src="${imgs[0].url}" alt="${v.brand} ${v.model}">
                            <div class="img-overlay">
                                <div class="zoom-ico">üîç</div>
                                <div class="zoom-label">Ver ${imgs.length} Foto${imgs.length>1?'s':''}</div>
                            </div>
                        </div>
                        ${imgs.length > 1 ? `
                            <div class="thumb-bar">
                                ${imgs.slice(1,4).map((img,i) => `<img class="thumb-img" src="${img.thumb||img.url}" onclick="viewGallery(${idx},${i+1})">`).join('')}
                                ${imgs.length > 4 ? `<div class="more-thumb" onclick="viewGallery(${idx})">+${imgs.length-4}</div>` : ''}
                            </div>
                        ` : ''}
                    ` : `
                        <div class="no-img">
                            <div class="no-img-ico">üì∑</div>
                            <div class="no-img-txt">Sem Imagem</div>
                        </div>
                    `}
                </div>

                <div class="v-body">
                    <div class="v-head">
                        <div class="v-info">
                            <h3 class="v-name">${v.brand} ${v.model}</h3>
                            <div class="year-tag">${v.year}</div>
                        </div>
                        <div class="v-tags">
                            <span class="cat-tag">${v.vehicle_data?.vehicle?.category_name||'N/A'}</span>
                        </div>
                    </div>

                    <div class="price-card">
                        <div class="price-amt">R$ ${fmt(v.price)}</div>
                    </div>

                    <div class="spec-list">
                        <span class="spec-tag">${num(v.mileage)} km</span>
                        <span class="spec-tag">${v.fuel_type||'N/A'}</span>
                        <span class="spec-tag">${v.transmission||'Manual'}</span>
                    </div>

                    <div class="loc-info">üìç ${v.location||'Local n√£o informado'}</div>

                    <div class="btn-group">
                        <button class="btn primary-btn" onclick="viewDetails(${idx})">Ver Detalhes</button>
                        <button class="btn secondary-btn" onclick="viewGallery(${idx})">Fotos (${imgs.length})</button>
                        ${v.laudo_file_url ? `<button class="btn warn-btn" onclick="window.open('${v.laudo_file_url}','_blank')">Ver Laudo</button>` : ''}
                        <button class="btn cta-btn" onclick="propose(${idx})">Fazer Proposta</button>
                    </div>
                </div>
            `

            return card
        }

        function fmt(p) {
            return parseFloat(p||0).toLocaleString('pt-BR', {minimumFractionDigits:2})
        }

        function num(n) {
            return parseInt(n||0).toLocaleString('pt-BR')
        }

        function updateStats() {
            document.getElementById('totalVehicles').textContent = APP_STATE.vehicles.length
        }

        function updateVisible(c) {
            document.getElementById('visibleCount').textContent = c
            document.getElementById('totalCount').textContent = APP_STATE.vehicles.length
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('searchInput').addEventListener('input', e => {
                const q = e.target.value.toLowerCase()
                document.querySelectorAll('.v-card').forEach(card => {
                    const idx = parseInt(card.getAttribute('data-index'))
                    const v = APP_STATE.vehicles[idx]
                    const txt = `${v.brand} ${v.model} ${v.description||''} ${v.color||''}`.toLowerCase()
                    card.style.display = txt.includes(q) ? '' : 'none'
                })
            })

            document.getElementById('categoryFilter').addEventListener('change', renderVehicles)
            document.getElementById('stateFilter').addEventListener('change', renderVehicles)
            document.getElementById('eventFilter').addEventListener('change', renderVehicles)
        })

        async function propose(idx) {
            const v = APP_STATE.vehicles[idx]

            if (!APP_STATE.isLoggedIn) {
                toast('Fa√ßa login para propor', 'error')
                setTimeout(() => window.location.href = 'login', 1500)
                return
            }

            if (!APP_STATE.currentUser.cpf) {
                toast('Complete seu cadastro', 'error')
                setTimeout(() => window.location.href = 'perfil', 1500)
                return
            }

            if (APP_STATE.currentUser.credits < 1) {
                toast('Cr√©ditos insuficientes', 'error')
                setTimeout(() => window.location.href = 'recarga', 1500)
                return
            }

            showProposalModal(v)
        }

        function showProposalModal(v) {
            modal('Nova Proposta', `
                <div style="text-align: center;">
                    <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 900;">${v.brand} ${v.model} ${v.year}</h3>
                    <p style="font-size: 1.75rem; color: var(--green-700); font-weight: 900; margin: 2rem 0;">
                        Pre√ßo Anunciado: R$ ${fmt(v.price)}
                    </p>

                    <form id="proposalForm" onsubmit="sendProposal(event,'${v.external_id}')">
                        <div class="field">
                            <label class="field-label">Valor da Proposta *</label>
                            <input type="number" id="proposalValue" class="field-input" placeholder="Ex: 45000.00" step="0.01" min="1" required>
                        </div>

                        <div class="field">
                            <label class="field-label">Seu Nome *</label>
                            <input type="text" id="clientName" class="field-input" value="${APP_STATE.currentUser.name}" required>
                        </div>

                        <div class="field">
                            <label class="field-label">Seu Telefone *</label>
                            <input type="tel" id="clientPhone" class="field-input" value="${APP_STATE.currentUser.phone}" required>
                        </div>

                        <div class="field">
                            <label class="field-label">Seu Email (opcional)</label>
                            <input type="email" id="clientEmail" class="field-input" value="${APP_STATE.currentUser.email||''}" placeholder="seu@email.com">
                        </div>

                        <div class="alert-box">
                            <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Esta proposta consumir√° <strong>1 cr√©dito (R$ 1.000,00)</strong> do seu saldo.<br>
                            Saldo atual: <strong>${parseFloat(APP_STATE.currentUser.credits).toFixed(1)} cr√©ditos</strong>
                        </div>

                        <button type="submit" class="btn cta-btn" style="width:100%">Enviar Proposta Agora</button>
                    </form>
                </div>
            `)
        }

        async function sendProposal(e, extId) {
            e.preventDefault()

            const btn = e.target.querySelector('button[type="submit"]')
            btn.disabled = true
            btn.textContent = 'Enviando...'

            try {
                const res = await fetch(`${API_BASE}/proposals`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify({
                        vehicle_external_id: extId,
                        proposal_amount: parseFloat(document.getElementById('proposalValue').value),
                        customer_name: document.getElementById('clientName').value,
                        customer_phone: document.getElementById('clientPhone').value,
                        customer_email: document.getElementById('clientEmail').value || null
                    })
                })

                const data = await res.json()

                if (data.success) {
                    APP_STATE.currentUser.credits = data.remaining_credits
                    updateUI()
                    closeModals()
                    toast('Proposta enviada com sucesso!', 'success')
                } else {
                    toast(data.error||'Erro ao enviar', 'error')
                    btn.disabled = false
                    btn.textContent = 'Enviar Proposta Agora'
                }
            } catch (err) {
                toast('Erro de conex√£o', 'error')
                btn.disabled = false
                btn.textContent = 'Enviar Proposta Agora'
            }
        }

        function viewDetails(idx) {
            const v = APP_STATE.vehicles[idx]

            modal(`${v.brand} ${v.model}`, `
                <div style="background: var(--slate-50); padding: 2.5rem; border-radius: var(--radius-lg);">
                    <h4 style="margin-bottom: 2rem; color: var(--green-800); font-weight: 900; font-size: 1.5rem;">üìã Informa√ß√µes Completas</h4>

                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Marca/Modelo:</strong> ${v.brand} ${v.model}</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Ano:</strong> ${v.year}</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Quilometragem:</strong> ${num(v.mileage)} km</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Combust√≠vel:</strong> ${v.fuel_type||'N/A'}</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Transmiss√£o:</strong> ${v.transmission||'Manual'}</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Cor:</strong> ${v.color||'N/A'}</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Pre√ßo:</strong> R$ ${fmt(v.price)}</p>
                    <p style="margin-bottom: 1rem; font-weight: 700;"><strong>Localiza√ß√£o:</strong> ${v.location||'N/A'}</p>

                    ${v.description ? `
                        <div style="margin-top: 2.5rem; padding-top: 2.5rem; border-top: 3px solid var(--slate-200);">
                            <h4 style="margin-bottom: 1.25rem; color: var(--green-800); font-weight: 900; font-size: 1.25rem;">üìù Descri√ß√£o</h4>
                            <p style="color: var(--slate-600); line-height: 1.8; font-weight: 600;">${v.description}</p>
                        </div>
                    ` : ''}
                </div>
            `)
        }

        function viewGallery(idx, start=0) {
            const v = APP_STATE.vehicles[idx]
            const imgs = v.images || []

            if (imgs.length === 0) {
                toast('Sem imagens', 'error')
                return
            }

            let cur = start

            const thumbnailsHtml = imgs.map((img, i) => `
                <div class="thumbnail-box ${i === cur ? 'active' : ''}" onclick="selectPhoto(${i})" data-thumb-index="${i}">
                    <img src="${img.thumb || img.url}" alt="Foto ${i + 1}">
                </div>
            `).join('')

            modal(`üì∑ ${v.brand} ${v.model}`, `
                <div style="margin-bottom: 2rem;">
                    <div class="main-photo-viewer">
                        <img id="mainPhoto" src="${imgs[cur].url}" alt="${v.brand} ${v.model}">
                        <div class="photo-counter-badge">
                            <span id="photoCounter">${cur + 1}</span> / ${imgs.length}
                        </div>
                    </div>
                    
                    <div class="thumbnails-section">
                        <h5>Selecione uma foto para visualizar</h5>
                        <div class="thumbnails-container">
                            ${thumbnailsHtml}
                        </div>
                    </div>
                </div>
            `, true)

            window.selectPhoto = (photoIndex) => {
                cur = photoIndex
                
                // Atualizar imagem principal
                document.getElementById('mainPhoto').src = imgs[cur].url
                
                // Atualizar contador
                document.getElementById('photoCounter').textContent = cur + 1
                
                // Atualizar thumbnail ativo
                document.querySelectorAll('.thumbnail-box').forEach((thumb, i) => {
                    if (i === photoIndex) {
                        thumb.classList.add('active')
                    } else {
                        thumb.classList.remove('active')
                    }
                })
            }
        }

        function modal(title, content, isGallery = false) {
            const m = document.createElement('div')
            m.className = 'overlay'
            m.innerHTML = `
                <div class="dialog ${isGallery ? 'gallery-dialog' : ''}">
                    <div class="dialog-head">
                        <h2 class="dialog-title">${title}</h2>
                        <button class="close-btn" onclick="closeM(this)">√ó</button>
                    </div>
                    <div class="dialog-body">${content}</div>
                </div>
            `

            document.body.appendChild(m)
            setTimeout(() => m.classList.add('show'), 10)

            m.addEventListener('click', e => {
                if (e.target === m) closeM(m.querySelector('.close-btn'))
            })

            return m
        }

        function closeM(btn) {
            const m = btn.closest('.overlay')
            m.classList.remove('show')
            setTimeout(() => m.remove(), 400)
        }

        function closeModals() {
            document.querySelectorAll('.overlay').forEach(m => {
                m.classList.remove('show')
                setTimeout(() => m.remove(), 400)
            })
        }

        async function logout() {
            try {
                await fetch(`${API_BASE}/auth/logout`, {method: 'POST', credentials: 'include'})
                APP_STATE.currentUser = null
                APP_STATE.isLoggedIn = false
                updateUI()
                toast('Logout realizado', 'success')
            } catch (err) {
                console.error(err)
            }
        }

        function toast(msg, type='success') {
            const wrap = document.getElementById('toastWrap')
            const t = document.createElement('div')
            t.className = `toast ${type}`
            t.textContent = msg
            wrap.appendChild(t)

            setTimeout(() => {
                t.style.opacity = '0'
                t.style.transform = 'translateX(500px)'
                setTimeout(() => t.remove(), 400)
            }, 3500)
        }

        window.addEventListener('DOMContentLoaded', () => {
            checkAuth().then(() => loadVehicles())
        })
    </script>
</body>
</html>

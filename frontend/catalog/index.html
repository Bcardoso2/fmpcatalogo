<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FMP REPASSES - Cat√°logo Premium</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --green-50: #ecfdf5;
            --green-100: #d1fae5;
            --green-200: #a7f3d0;
            --green-500: #10b981;
            --green-600: #059669;
            --green-700: #047857;
            --green-800: #0d5c3d;
            --green-900: #064e3b;
            
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-600: #475569;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
        }
        
        body { 
            font-family: 'Outfit', system-ui, -apple-system, sans-serif;
            background: var(--slate-50);
            color: var(--slate-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .hidden { display: none !important; }
        
        /* ==================== HEADER MOBILE FIRST ==================== */
        .header {
            background: linear-gradient(180deg, #000000 0%, #0a2015 100%);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .header-wrap {
            padding: 1rem;
        }
        
        /* Logo compacto mobile */
        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            margin-bottom: 1rem;
        }
        
        .brand-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-700) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 900;
            color: white;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
        }
        
        .brand-text {
            flex: 1;
        }
        
        .brand-name {
            font-size: 1.125rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, var(--green-200) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }
        
        .brand-tagline {
            font-size: 0.625rem;
            color: var(--green-300);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* User chip mobile */
        .user-chip {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .user-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
        }
        
        .user-name {
            color: white;
            font-weight: 700;
            font-size: 0.875rem;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .credits-pill {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            padding: 0.375rem 0.75rem;
            border-radius: 100px;
            font-weight: 800;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .logout-btn {
            width: 100%;
            background: rgba(239, 68, 68, 0.15);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 0.625rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .logout-btn:active {
            transform: scale(0.97);
            background: #ef4444;
            color: white;
        }

        .login-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-700) 100%);
            color: white;
            padding: 0.875rem;
            border-radius: 12px;
            font-weight: 800;
            text-decoration: none;
            font-size: 0.9375rem;
            text-align: center;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            margin-bottom: 1rem;
        }

        .login-btn:active {
            transform: scale(0.97);
        }

        /* Nav mobile - horizontal scroll */
        .nav-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            margin: 0 -1rem 1rem;
            padding: 0 1rem;
        }
        
        .nav-wrapper::-webkit-scrollbar {
            display: none;
        }
        
        .nav-bar {
            display: flex;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
            min-width: min-content;
        }

        .nav-item {
            padding: 0.625rem 1.25rem;
            border-radius: 100px;
            text-decoration: none;
            color: rgba(255,255,255,0.6);
            font-weight: 700;
            font-size: 0.8125rem;
            transition: all 0.3s;
            border: 1px solid transparent;
            white-space: nowrap;
            background: rgba(255,255,255,0.05);
        }

        .nav-item:active,
        .nav-item.active {
            color: white;
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.2);
            transform: scale(0.97);
        }

        /* M√©tricas mobile */
        .metrics {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .metric {
            text-align: center;
            background: rgba(255,255,255,0.05);
            padding: 0.875rem;
            border-radius: 12px;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 900;
            background: linear-gradient(135deg, white 0%, var(--green-200) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.6875rem;
            color: var(--green-300);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* ==================== CONTAINER ==================== */
        .wrap {
            padding: 1rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* ==================== LOADING ==================== */
        .loader {
            text-align: center;
            padding: 4rem 1rem;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--slate-200);
            border-top-color: var(--green-600);
            border-radius: 50%;
            animation: rotate 0.8s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        .loader p {
            font-weight: 700;
            color: var(--slate-400);
            font-size: 0.9375rem;
        }

        /* ==================== FILTERS MOBILE FIRST ==================== */
        .filter-panel {
            background: white;
            border-radius: 16px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        /* Search box otimizado mobile */
        .search-box {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 0.875rem 0.875rem 2.75rem;
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: 12px;
            font-size: 0.9375rem;
            font-family: inherit;
            font-weight: 600;
            color: var(--slate-900);
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--green-600);
            background: white;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .search-input::placeholder {
            color: var(--slate-400);
            font-size: 0.875rem;
        }

        .search-ico {
            position: absolute;
            left: 0.875rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.125rem;
        }

        /* Bot√£o toggle filtros mobile */
        .filter-toggle-btn {
            width: 100%;
            background: var(--green-600);
            color: white;
            border: none;
            padding: 0.875rem;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.9375rem;
            cursor: pointer;
            font-family: inherit;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .filter-toggle-btn:active {
            transform: scale(0.97);
        }

        .filter-toggle-btn .arrow {
            transition: transform 0.3s;
        }

        .filter-toggle-btn.active .arrow {
            transform: rotate(180deg);
        }

        /* √Årea de filtros colaps√°vel */
        .filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .filter-content.expanded {
            max-height: 1000px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .dropdown {
            padding: 0.875rem;
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: 12px;
            font-size: 0.875rem;
            font-family: inherit;
            font-weight: 700;
            color: var(--slate-900);
            cursor: pointer;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23334155' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.875rem center;
            padding-right: 2.5rem;
        }

        .dropdown:focus {
            outline: none;
            border-color: var(--green-600);
            background-color: white;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        /* Summary compacto */
        .summary {
            background: linear-gradient(135deg, var(--green-50) 0%, var(--slate-50) 100%);
            border: 2px solid var(--green-200);
            border-radius: 12px;
            padding: 0.875rem;
            margin-top: 1rem;
            text-align: center;
            font-weight: 700;
            font-size: 0.8125rem;
            color: var(--green-800);
        }

        .summary strong {
            font-weight: 900;
            color: var(--green-700);
        }

        /* ==================== EVENT BANNER MOBILE ==================== */
        .event-block {
            margin-bottom: 2rem;
        }

        .event-head {
            background: linear-gradient(135deg, var(--green-800) 0%, var(--green-900) 100%);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 16px rgba(13, 92, 61, 0.3);
        }

        .event-title {
            font-size: 1.125rem;
            font-weight: 900;
            color: white;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .event-count {
            background: white;
            color: var(--green-800);
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 1rem;
            display: inline-block;
            margin: 0 auto;
            display: block;
            width: fit-content;
        }

        /* ==================== GRID MOBILE FIRST ==================== */
        .vehicle-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.25rem;
        }

        .v-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--slate-200);
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .v-card:active {
            transform: scale(0.98);
        }

        /* ==================== IMAGE SECTION MOBILE ==================== */
        .img-zone {
            position: relative;
            background: var(--slate-100);
        }

        .main-img {
            position: relative;
            height: 220px;
            cursor: pointer;
            overflow: hidden;
            background: linear-gradient(135deg, var(--slate-100) 0%, var(--slate-200) 100%);
        }

        .main-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .v-card:active .main-img img {
            transform: scale(1.05);
        }

        /* Badge de quantidade de fotos */
        .photo-badge {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: rgba(0,0,0,0.75);
            backdrop-filter: blur(10px);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 100px;
            font-weight: 800;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            z-index: 10;
        }

        /* Thumbnails mobile - horizontal scroll */
        .thumb-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding: 0.5rem;
            background: rgba(0,0,0,0.03);
        }

        .thumb-wrapper::-webkit-scrollbar {
            display: none;
        }

        .thumb-bar {
            display: flex;
            gap: 0.5rem;
            min-width: min-content;
        }

        .thumb-img {
            width: 64px;
            height: 48px;
            flex-shrink: 0;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .thumb-img:active {
            border-color: var(--green-600);
            transform: scale(1.05);
        }

        .more-thumb {
            width: 64px;
            height: 48px;
            flex-shrink: 0;
            background: var(--green-50);
            border: 2px solid var(--green-600);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: var(--green-700);
            cursor: pointer;
            font-size: 0.875rem;
        }

        .more-thumb:active {
            background: var(--green-600);
            color: white;
            transform: scale(1.05);
        }

        .no-img {
            height: 220px;
            background: linear-gradient(135deg, var(--slate-100) 0%, var(--slate-200) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .no-img-ico {
            font-size: 3rem;
            margin-bottom: 0.75rem;
            opacity: 0.3;
        }

        .no-img-txt {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--slate-400);
        }

        /* ==================== CARD BODY MOBILE ==================== */
        .v-body {
            padding: 1rem;
        }

        .v-head {
            margin-bottom: 1rem;
        }

        .v-name {
            font-size: 1.125rem;
            font-weight: 900;
            color: var(--slate-900);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .v-subtitle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .year-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--green-50) 0%, var(--green-100) 100%);
            color: var(--green-800);
            padding: 0.375rem 0.875rem;
            border-radius: 100px;
            font-weight: 800;
            font-size: 0.75rem;
            border: 2px solid var(--green-200);
        }

        .cat-tag {
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-800) 100%);
            color: white;
            padding: 0.375rem 0.875rem;
            border-radius: 100px;
            font-weight: 800;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        /* Pre√ßo destaque mobile */
        .price-card {
            background: linear-gradient(135deg, var(--green-50) 0%, white 100%);
            border: 2px solid var(--green-200);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .price-label {
            font-size: 0.6875rem;
            color: var(--green-700);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .price-amt {
            font-size: 1.75rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-800) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            line-height: 1;
        }

        /* Specs compactos mobile */
        .spec-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .spec-tag {
            background: var(--slate-50);
            border: 1px solid var(--slate-200);
            padding: 0.5rem 0.875rem;
            border-radius: 100px;
            font-weight: 700;
            font-size: 0.75rem;
            color: var(--slate-700);
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .spec-icon {
            font-size: 0.875rem;
        }

        .loc-info {
            color: var(--slate-500);
            font-weight: 700;
            font-size: 0.8125rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        /* Bot√µes mobile otimizados */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.625rem;
        }

        .btn {
            padding: 0.875rem;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--green-600) 0%, var(--green-800) 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(13, 92, 61, 0.25);
        }

        .secondary-btn {
            background: var(--slate-50);
            color: var(--green-700);
            border: 2px solid var(--slate-200);
        }

        .cta-btn {
            background: linear-gradient(135deg, var(--green-500) 0%, var(--green-700) 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            font-size: 1rem;
        }

        .warn-btn {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.25);
        }

        /* ==================== MODAL MOBILE ==================== */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 0;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .dialog {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 92vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .overlay.show .dialog {
            transform: translateY(0);
        }

        .dialog-head {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--slate-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--slate-50);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .dialog-title {
            font-size: 1.25rem;
            font-weight: 900;
            color: var(--green-800);
            flex: 1;
            padding-right: 1rem;
        }

        .close-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid var(--slate-200);
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--slate-400);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-btn:active {
            transform: scale(0.95);
            background: var(--slate-100);
        }

        .dialog-body {
            padding: 1rem;
        }

        /* Form fields mobile */
        .field {
            margin-bottom: 1.25rem;
        }

        .field-label {
            display: block;
            font-weight: 800;
            font-size: 0.875rem;
            color: var(--slate-900);
            margin-bottom: 0.5rem;
        }

        .field-input {
            width: 100%;
            padding: 0.875rem;
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: 12px;
            font-size: 0.9375rem;
            font-family: inherit;
            font-weight: 600;
            color: var(--slate-900);
            transition: all 0.3s;
        }

        .field-input:focus {
            outline: none;
            border-color: var(--green-600);
            background: white;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .alert-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 1rem;
            margin: 1.25rem 0;
            font-weight: 700;
            font-size: 0.8125rem;
            color: #92400e;
            line-height: 1.6;
        }

        /* ==================== GALLERY MOBILE ==================== */
        .gallery-viewer {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .main-photo-container {
            position: relative;
            min-height: 50vh;
            max-height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        .main-photo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-height: 60vh;
        }

        .photo-counter {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 0.5rem 0.875rem;
            border-radius: 100px;
            font-weight: 900;
            font-size: 0.8125rem;
        }

        /* Thumbnails grid mobile */
        .thumbnails-section {
            padding: 1rem;
            background: var(--slate-50);
        }

        .thumbnails-section h5 {
            font-size: 0.875rem;
            font-weight: 800;
            color: var(--green-800);
            margin-bottom: 0.75rem;
        }

        .thumbnails-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .thumbnail-box {
            aspect-ratio: 16/9;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
            background: var(--slate-200);
        }

        .thumbnail-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-box:active {
            transform: scale(0.95);
        }

        .thumbnail-box.active {
            border-color: var(--green-600);
            box-shadow: 0 0 0 2px var(--green-200);
        }

        .thumbnail-box.active::after {
            content: '‚úì';
            position: absolute;
            top: 0.375rem;
            right: 0.375rem;
            background: var(--green-600);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.75rem;
        }

        /* ==================== TOAST MOBILE ==================== */
        #toastWrap {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 800;
            font-size: 0.9375rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        @keyframes slideUp {
            from { 
                transform: translateY(100px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }

        .toast.success {
            border-left: 6px solid var(--green-600);
            color: var(--green-700);
        }

        .toast.error {
            border-left: 6px solid #ef4444;
            color: #dc2626;
        }

        .toast::before {
            font-size: 1.25rem;
        }

        .toast.success::before {
            content: '‚úì';
        }

        .toast.error::before {
            content: '‚ö†';
        }

        /* ==================== TABLET 640px+ ==================== */
        @media (min-width: 640px) {
            .header-wrap {
                padding: 1.5rem 2rem;
            }

            .brand-icon {
                width: 52px;
                height: 52px;
                font-size: 1.75rem;
            }

            .brand-name {
                font-size: 1.5rem;
            }

            .brand-tagline {
                font-size: 0.75rem;
            }

            .user-chip {
                flex-direction: row;
                align-items: center;
                padding: 1rem 1.5rem;
            }

            .user-info-row {
                flex: 1;
            }

            .logout-btn {
                width: auto;
                padding: 0.625rem 1.5rem;
            }

            .metrics {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .vehicle-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }

            .main-img {
                height: 260px;
            }

            .v-body {
                padding: 1.5rem;
            }

            .btn-group {
                grid-template-columns: 1fr 1fr;
            }

            .btn-group .cta-btn {
                grid-column: 1 / -1;
            }

            .filter-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .thumbnails-container {
                grid-template-columns: repeat(4, 1fr);
            }

            .overlay {
                align-items: center;
                padding: 2rem;
            }

            .dialog {
                border-radius: 20px;
                max-width: 600px;
                transform: scale(0.9);
            }

            .overlay.show .dialog {
                transform: scale(1);
            }

            #toastWrap {
                top: 1.5rem;
                right: 1.5rem;
                left: auto;
                bottom: auto;
            }

            .toast {
                min-width: 360px;
                animation: slideRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            @keyframes slideRight {
                from { 
                    transform: translateX(400px); 
                    opacity: 0; 
                }
                to { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
            }
        }

        /* ==================== DESKTOP 1024px+ ==================== */
        @media (min-width: 1024px) {
            .header-wrap {
                padding: 2rem 3rem;
            }

            .brand-icon {
                width: 64px;
                height: 64px;
                font-size: 2rem;
            }

            .brand-name {
                font-size: 2rem;
            }

            .metrics {
                grid-template-columns: repeat(3, 1fr);
                gap: 2rem;
            }

            .wrap {
                padding: 3rem 2rem;
            }

            .filter-panel {
                padding: 2.5rem;
            }

            .filter-row {
                grid-template-columns: repeat(3, 1fr);
                gap: 1.25rem;
            }

            .vehicle-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 2rem;
            }

            .main-img {
                height: 300px;
            }

            .v-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 12px 32px rgba(0,0,0,0.12);
            }

            .v-card:active {
                transform: translateY(-4px);
            }

            .thumb-img:hover {
                border-color: var(--green-400);
                transform: scale(1.1);
            }

            .thumbnail-box:hover {
                border-color: var(--green-400);
                transform: scale(1.05);
            }

            .dialog {
                max-width: 900px;
            }

            .thumbnails-container {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        /* ==================== DESKTOP XL 1280px+ ==================== */
        @media (min-width: 1280px) {
            .filter-row {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }

            .vehicle-grid {
                grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="toastWrap"></div>

    <header class="header">
        <div class="header-wrap">
            <a href="/" class="brand">
                <div class="brand-icon">F</div>
                <div class="brand-text">
                    <div class="brand-name">FMP REPASSES</div>
                    <div class="brand-tagline">Ve√≠culos Premium</div>
                </div>
            </a>

            <div class="user-chip hidden" id="userChip">
                <div class="user-info-row">
                    <span class="user-name" id="userName"></span>
                    <span class="credits-pill" id="userCredits">0 cr√©ditos</span>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            </div>
            
            <a href="login" class="login-btn" id="loginBtn">üîê Entrar Agora</a>

            <div class="nav-wrapper" id="navWrapper">
                <nav class="nav-bar">
                    <a href="/" class="nav-item active">üè† Cat√°logo</a>
                    <a href="propostas" class="nav-item">üìã Propostas</a>
                    <a href="recarga" class="nav-item">üí∞ Recarregar</a>
                    <a href="perfil" class="nav-item">üë§ Perfil</a>
                </nav>
            </div>

            <div class="metrics">
                <div class="metric">
                    <span class="metric-value" id="totalVehicles">0</span>
                    <span class="metric-label">Ve√≠culos</span>
                </div>
            </div>
        </div>
    </header>

    <div class="wrap">
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Carregando cat√°logo...</p>
        </div>

        <div id="catalog" class="hidden">
            <div class="filter-panel">
                <div class="search-box">
                    <div class="search-ico">üîç</div>
                    <input 
                        type="search" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Buscar por marca, modelo..."
                        autocomplete="off"
                    >
                </div>

                <button class="filter-toggle-btn" id="filterToggle" onclick="toggleFilters()">
                    <span>üéõÔ∏è Filtros Avan√ßados</span>
                    <span class="arrow">‚ñº</span>
                </button>

                <div class="filter-content" id="filterContent">
                    <div class="filter-row">
                        <select class="dropdown" id="categoryFilter">
                            <option value="all">üì¶ Todas Categorias</option>
                        </select>

                        <select class="dropdown" id="stateFilter">
                            <option value="all">üìç Todos Estados</option>
                        </select>

                        <select class="dropdown" id="eventFilter">
                            <option value="all">üìÖ Todos Eventos</option>
                        </select>

                        <select class="dropdown" id="priceFilter">
                            <option value="all">üí∞ Todos Pre√ßos</option>
                            <option value="0-10000">At√© R$ 10k</option>
                            <option value="10000-20000">R$ 10k - 20k</option>
                            <option value="20000-30000">R$ 20k - 30k</option>
                            <option value="30000-50000">R$ 30k - 50k</option>
                            <option value="50000-100000">R$ 50k - 100k</option>
                            <option value="100000-999999999">Acima R$ 100k</option>
                        </select>

                        <select class="dropdown" id="sortFilter">
                            <option value="none">üîÑ Ordenar por</option>
                            <option value="price-asc">Menor Pre√ßo</option>
                            <option value="price-desc">Maior Pre√ßo</option>
                            <option value="year-desc">Ano (Novo)</option>
                            <option value="year-asc">Ano (Antigo)</option>
                            <option value="km-asc">Menor KM</option>
                            <option value="km-desc">Maior KM</option>
                        </select>
                    </div>
                </div>

                <div class="summary">
                    <span id="visibleCount">0</span> de <strong id="totalCount">0</strong> ve√≠culos
                </div>
            </div>

            <div id="vehiclesGrid"></div>
        </div>
    </div>

    <script>
        const APP_STATE = {
            vehicles: [],
            currentUser: null,
            isLoggedIn: false,
            filtersExpanded: false
        }

        const API_BASE = window.location.origin + '/api'

        function toggleFilters() {
            APP_STATE.filtersExpanded = !APP_STATE.filtersExpanded
            const content = document.getElementById('filterContent')
            const btn = document.getElementById('filterToggle')
            
            if (APP_STATE.filtersExpanded) {
                content.classList.add('expanded')
                btn.classList.add('active')
            } else {
                content.classList.remove('expanded')
                btn.classList.remove('active')
            }
        }

        async function loadVehicles() {
            try {
                const res = await fetch(`${API_BASE}/vehicles`, { credentials: 'include' })
                const data = await res.json()

                if (data.success) {
                    APP_STATE.vehicles = data.vehicles
                    populateFilters()
                    renderVehicles()
                    updateStats()
                } else {
                    toast('Erro ao carregar ve√≠culos', 'error')
                }
            } catch (err) {
                console.error(err)
                toast('Erro de conex√£o', 'error')
            } finally {
                document.getElementById('loader').classList.add('hidden')
                document.getElementById('catalog').classList.remove('hidden')
            }
        }

        async function checkAuth() {
            try {
                const res = await fetch(`${API_BASE}/auth/me`, { credentials: 'include' })
                const data = await res.json()

                if (data.success && data.user) {
                    APP_STATE.currentUser = data.user
                    APP_STATE.isLoggedIn = true
                }

                updateUI()
            } catch (err) {
                updateUI()
            }
        }

        function updateUI() {
            const chip = document.getElementById('userChip')
            const btn = document.getElementById('loginBtn')
            const nav = document.getElementById('navWrapper')

            if (APP_STATE.isLoggedIn && APP_STATE.currentUser) {
                chip.classList.remove('hidden')
                btn.classList.add('hidden')
                nav.classList.remove('hidden')
                document.getElementById('userName').textContent = APP_STATE.currentUser.name
                document.getElementById('userCredits').textContent = `${parseFloat(APP_STATE.currentUser.credits).toFixed(1)} cr√©ditos`
            } else {
                chip.classList.add('hidden')
                btn.classList.remove('hidden')
                nav.classList.add('hidden')
            }
        }

        function populateFilters() {
            const catF = document.getElementById('categoryFilter')
            const staF = document.getElementById('stateFilter')
            const evtF = document.getElementById('eventFilter')

            const cats = [...new Set(APP_STATE.vehicles.map(v => v.vehicle_data?.vehicle?.category_name).filter(Boolean))].sort()
            const stas = [...new Set(APP_STATE.vehicles.map(v => v.vehicle_data?.shop_stock?.state).filter(Boolean))].sort()
            const evts = [...new Set(APP_STATE.vehicles.map(v => {
                const fd = v.vehicle_data?.negotiation?.finish_date_display
                return fd ? fd.split(' ')[0] : null
            }).filter(Boolean))].sort((a,b) => new Date(b) - new Date(a))

            cats.forEach(c => {
                const o = document.createElement('option')
                o.value = c
                o.textContent = c
                catF.appendChild(o)
            })

            stas.forEach(s => {
                const o = document.createElement('option')
                o.value = s
                o.textContent = s
                staF.appendChild(o)
            })

            evts.forEach(e => {
                const [y,m,d] = e.split('-')
                const o = document.createElement('option')
                o.value = e
                o.textContent = `${d}/${m}/${y}`
                evtF.appendChild(o)
            })
        }

        function renderVehicles() {
            const grid = document.getElementById('vehiclesGrid')
            grid.innerHTML = ''

            let filtered = [...APP_STATE.vehicles]

            const catF = document.getElementById('categoryFilter').value
            const staF = document.getElementById('stateFilter').value
            const evtF = document.getElementById('eventFilter').value

            if (catF !== 'all') filtered = filtered.filter(v => v.vehicle_data?.vehicle?.category_name === catF)
            if (staF !== 'all') filtered = filtered.filter(v => v.vehicle_data?.shop_stock?.state === staF)
            if (evtF !== 'all') filtered = filtered.filter(v => {
                const fd = v.vehicle_data?.negotiation?.finish_date_display
                return fd && fd.split(' ')[0] === evtF
            })

            const grouped = {}
            filtered.forEach(v => {
                const fd = v.vehicle_data?.negotiation?.finish_date_display
                const dt = fd ? fd.split(' ')[0] : 'no-date'
                if (!grouped[dt]) grouped[dt] = []
                grouped[dt].push(v)
            })

            const sorted = Object.keys(grouped).sort((a,b) => {
                if (a === 'no-date') return 1
                if (b === 'no-date') return -1
                return new Date(b) - new Date(a)
            })

            sorted.forEach(dt => {
                const sec = document.createElement('div')
                sec.className = 'event-block'

                let fmt
                if (dt === 'no-date') {
                    fmt = 'Sem Data Definida'
                } else {
                    const [y,m,d] = dt.split('-')
                    fmt = `${d}/${m}/${y}`
                }

                sec.innerHTML = `
                    <div class="event-head">
                        <h2 class="event-title">üìÖ ${fmt}</h2>
                        <div class="event-count">${grouped[dt].length} ve√≠culos</div>
                    </div>
                    <div class="vehicle-grid" id="grid-${dt}"></div>
                `

                grid.appendChild(sec)

                const subgrid = document.getElementById(`grid-${dt}`)
                grouped[dt].forEach(v => {
                    const idx = APP_STATE.vehicles.indexOf(v)
                    subgrid.appendChild(buildCard(v, idx))
                })
            })

            updateVisible(filtered.length)
        }

        function buildCard(v, idx) {
            const card = document.createElement('div')
            card.className = 'v-card'
            card.setAttribute('data-index', idx)

            const imgs = v.images || []
            const hasImgs = imgs.length > 0

            card.innerHTML = `
                <div class="img-zone">
                    ${hasImgs ? `
                        <div class="main-img" onclick="viewGallery(${idx})">
                            <img src="${imgs[0].url}" alt="${v.brand} ${v.model}" loading="lazy">
                            <div class="photo-badge">
                                üì∑ ${imgs.length}
                            </div>
                        </div>
                        ${imgs.length > 1 ? `
                            <div class="thumb-wrapper">
                                <div class="thumb-bar">
                                    ${imgs.slice(1,5).map((img,i) => `
                                        <img class="thumb-img" src="${img.thumb||img.url}" onclick="viewGallery(${idx},${i+1})" loading="lazy">
                                    `).join('')}
                                    ${imgs.length > 5 ? `<div class="more-thumb" onclick="viewGallery(${idx})">+${imgs.length-5}</div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    ` : `
                        <div class="no-img">
                            <div class="no-img-ico">üì∑</div>
                            <div class="no-img-txt">Sem Imagem</div>
                        </div>
                    `}
                </div>

                <div class="v-body">
                    <div class="v-head">
                        <h3 class="v-name">${v.brand} ${v.model}</h3>
                        <div class="v-subtitle">
                            <span class="year-tag">üìÖ ${v.year}</span>
                            <span class="cat-tag">${v.vehicle_data?.vehicle?.category_name||'N/A'}</span>
                        </div>
                    </div>

                    <div class="price-card">
                        <div class="price-label">Pre√ßo</div>
                        <div class="price-amt">R$ ${fmt(v.price)}</div>
                    </div>

                    <div class="spec-list">
                        <span class="spec-tag">
                            <span class="spec-icon">üõ£Ô∏è</span>
                            ${num(v.mileage)} km
                        </span>
                        <span class="spec-tag">
                            <span class="spec-icon">‚õΩ</span>
                            ${v.fuel_type||'N/A'}
                        </span>
                        <span class="spec-tag">
                            <span class="spec-icon">‚öôÔ∏è</span>
                            ${v.transmission||'Manual'}
                        </span>
                    </div>

                    <div class="loc-info">
                        üìç ${v.location||'Local n√£o informado'}
                    </div>

                    <div class="btn-group">
                        <button class="btn primary-btn" onclick="viewDetails(${idx})">
                            üìã Detalhes
                        </button>
                        <button class="btn secondary-btn" onclick="viewGallery(${idx})">
                            üì∑ Fotos (${imgs.length})
                        </button>
                        ${v.laudo_file_url ? `
                            <button class="btn warn-btn" onclick="window.open('${v.laudo_file_url}','_blank')">
                                üìÑ Ver Laudo
                            </button>
                        ` : ''}
                        <button class="btn cta-btn" onclick="propose(${idx})">
                            üí∞ Fazer Proposta
                        </button>
                    </div>
                </div>
            `

            return card
        }

        function fmt(p) {
            return parseFloat(p||0).toLocaleString('pt-BR', {minimumFractionDigits:2})
        }

        function num(n) {
            return parseInt(n||0).toLocaleString('pt-BR')
        }

        function updateStats() {
            document.getElementById('totalVehicles').textContent = APP_STATE.vehicles.length
        }

        function updateVisible(c) {
            document.getElementById('visibleCount').textContent = c
            document.getElementById('totalCount').textContent = APP_STATE.vehicles.length
        }

        document.addEventListener('DOMContentLoaded', () => {
            let searchTimeout
            document.getElementById('searchInput').addEventListener('input', e => {
                clearTimeout(searchTimeout)
                searchTimeout = setTimeout(() => {
                    const q = e.target.value.toLowerCase()
                    document.querySelectorAll('.v-card').forEach(card => {
                        const idx = parseInt(card.getAttribute('data-index'))
                        const v = APP_STATE.vehicles[idx]
                        const txt = `${v.brand} ${v.model} ${v.description||''} ${v.color||''}`.toLowerCase()
                        card.style.display = txt.includes(q) ? '' : 'none'
                    })
                }, 300)
            })

            document.getElementById('categoryFilter').addEventListener('change', renderVehicles)
            document.getElementById('stateFilter').addEventListener('change', renderVehicles)
            document.getElementById('eventFilter').addEventListener('change', renderVehicles)
        })

        async function propose(idx) {
            const v = APP_STATE.vehicles[idx]

            if (!APP_STATE.isLoggedIn) {
                toast('Fa√ßa login para propor', 'error')
                setTimeout(() => window.location.href = 'login', 1500)
                return
            }

            if (!APP_STATE.currentUser.cpf) {
                toast('Complete seu cadastro', 'error')
                setTimeout(() => window.location.href = 'perfil', 1500)
                return
            }

            if (APP_STATE.currentUser.credits < 1) {
                toast('Cr√©ditos insuficientes', 'error')
                setTimeout(() => window.location.href = 'recarga', 1500)
                return
            }

            showProposalModal(v)
        }

        function showProposalModal(v) {
            modal('üí∞ Nova Proposta', `
                <div style="text-align: center;">
                    <h3 style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 900; color: var(--slate-800);">
                        ${v.brand} ${v.model} ${v.year}
                    </h3>
                    <div style="background: var(--green-50); padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <div style="font-size: 0.75rem; color: var(--green-700); font-weight: 700; margin-bottom: 0.25rem;">
                            Pre√ßo Anunciado
                        </div>
                        <div style="font-size: 1.5rem; color: var(--green-700); font-weight: 900;">
                            R$ ${fmt(v.price)}
                        </div>
                    </div>

                    <form id="proposalForm" onsubmit="sendProposal(event,'${v.external_id}')">
                        <div class="field">
                            <label class="field-label">üíµ Valor da Proposta *</label>
                            <input 
                                type="number" 
                                id="proposalValue" 
                                class="field-input" 
                                placeholder="Ex: 45000.00" 
                                step="0.01" 
                                min="1" 
                                required
                                inputmode="decimal"
                            >
                        </div>

                        <div class="field">
                            <label class="field-label">üë§ Seu Nome *</label>
                            <input 
                                type="text" 
                                id="clientName" 
                                class="field-input" 
                                value="${APP_STATE.currentUser.name}" 
                                required
                            >
                        </div>

                        <div class="field">
                            <label class="field-label">üì± Seu Telefone *</label>
                            <input 
                                type="tel" 
                                id="clientPhone" 
                                class="field-input" 
                                value="${APP_STATE.currentUser.phone}" 
                                required
                                inputmode="tel"
                            >
                        </div>

                        <div class="field">
                            <label class="field-label">üìß Seu Email (opcional)</label>
                            <input 
                                type="email" 
                                id="clientEmail" 
                                class="field-input" 
                                value="${APP_STATE.currentUser.email||''}" 
                                placeholder="seu@email.com"
                                inputmode="email"
                            >
                        </div>

                        <div class="alert-box">
                            <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Esta proposta consumir√° <strong>1 cr√©dito (R$ 1.000)</strong>.<br>
                            Saldo atual: <strong>${parseFloat(APP_STATE.currentUser.credits).toFixed(1)} cr√©ditos</strong>
                        </div>

                        <button type="submit" class="btn cta-btn" style="width:100%">
                            üöÄ Enviar Proposta
                        </button>
                    </form>
                </div>
            `)
        }

        async function sendProposal(e, extId) {
            e.preventDefault()

            const btn = e.target.querySelector('button[type="submit"]')
            btn.disabled = true
            btn.innerHTML = '‚è≥ Enviando...'

            try {
                const res = await fetch(`${API_BASE}/proposals`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify({
                        vehicle_external_id: extId,
                        proposal_amount: parseFloat(document.getElementById('proposalValue').value),
                        customer_name: document.getElementById('clientName').value,
                        customer_phone: document.getElementById('clientPhone').value,
                        customer_email: document.getElementById('clientEmail').value || null
                    })
                })

                const data = await res.json()

                if (data.success) {
                    APP_STATE.currentUser.credits = data.remaining_credits
                    updateUI()
                    closeModals()
                    toast('Proposta enviada!', 'success')
                } else {
                    toast(data.error||'Erro ao enviar', 'error')
                    btn.disabled = false
                    btn.innerHTML = 'üöÄ Enviar Proposta'
                }
            } catch (err) {
                toast('Erro de conex√£o', 'error')
                btn.disabled = false
                btn.innerHTML = 'üöÄ Enviar Proposta'
            }
        }

        function viewDetails(idx) {
            const v = APP_STATE.vehicles[idx]

            modal(`${v.brand} ${v.model}`, `
                <div style="background: var(--slate-50); padding: 1.5rem; border-radius: 12px;">
                    <h4 style="margin-bottom: 1.25rem; color: var(--green-800); font-weight: 900; font-size: 1.125rem;">
                        üìã Informa√ß√µes Completas
                    </h4>

                    <div style="display: grid; gap: 0.75rem; font-size: 0.9375rem;">
                        <p style="font-weight: 700;"><strong>üöó Marca/Modelo:</strong> ${v.brand} ${v.model}</p>
                        <p style="font-weight: 700;"><strong>üìÖ Ano:</strong> ${v.year}</p>
                        <p style="font-weight: 700;"><strong>üõ£Ô∏è Quilometragem:</strong> ${num(v.mileage)} km</p>
                        <p style="font-weight: 700;"><strong>‚õΩ Combust√≠vel:</strong> ${v.fuel_type||'N/A'}</p>
                        <p style="font-weight: 700;"><strong>‚öôÔ∏è Transmiss√£o:</strong> ${v.transmission||'Manual'}</p>
                        <p style="font-weight: 700;"><strong>üé® Cor:</strong> ${v.color||'N/A'}</p>
                        <p style="font-weight: 700;"><strong>üí∞ Pre√ßo:</strong> R$ ${fmt(v.price)}</p>
                        <p style="font-weight: 700;"><strong>üìç Localiza√ß√£o:</strong> ${v.location||'N/A'}</p>
                    </div>

                    ${v.description ? `
                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid var(--slate-200);">
                            <h4 style="margin-bottom: 0.75rem; color: var(--green-800); font-weight: 900; font-size: 1rem;">
                                üìù Descri√ß√£o
                            </h4>
                            <p style="color: var(--slate-600); line-height: 1.6; font-weight: 600; font-size: 0.875rem;">
                                ${v.description}
                            </p>
                        </div>
                    ` : ''}
                </div>
            `)
        }

        function viewGallery(idx, start=0) {
            const v = APP_STATE.vehicles[idx]
            const imgs = v.images || []

            if (imgs.length === 0) {
                toast('Sem imagens dispon√≠veis', 'error')
                return
            }

            let cur = start

            const thumbnailsHtml = imgs.map((img, i) => `
                <div class="thumbnail-box ${i === cur ? 'active' : ''}" onclick="selectPhoto(${i})" data-thumb-index="${i}">
                    <img src="${img.thumb || img.url}" alt="Foto ${i + 1}" loading="lazy">
                </div>
            `).join('')

            modal(`üì∑ ${v.brand} ${v.model}`, `
                <div class="gallery-viewer">
                    <div class="main-photo-container">
                        <img id="mainPhoto" src="${imgs[cur].url}" alt="${v.brand} ${v.model}" class="main-photo">
                        <div class="photo-counter">
                            <span id="photoCounter">${cur + 1}</span> / ${imgs.length}
                        </div>
                    </div>
                    
                    <div class="thumbnails-section">
                        <h5>üì∏ Toque para visualizar</h5>
                        <div class="thumbnails-container">
                            ${thumbnailsHtml}
                        </div>
                    </div>
                </div>
            `)

            window.selectPhoto = (photoIndex) => {
                cur = photoIndex
                
                const mainPhoto = document.getElementById('mainPhoto')
                mainPhoto.style.opacity = '0'
                
                setTimeout(() => {
                    mainPhoto.src = imgs[cur].url
                    mainPhoto.style.opacity = '1'
                    document.getElementById('photoCounter').textContent = cur + 1
                    
                    document.querySelectorAll('.thumbnail-box').forEach((thumb, i) => {
                        thumb.classList.toggle('active', i === photoIndex)
                    })
                }, 150)
            }
        }

        function modal(title, content) {
            const m = document.createElement('div')
            m.className = 'overlay'
            m.innerHTML = `
                <div class="dialog">
                    <div class="dialog-head">
                        <h2 class="dialog-title">${title}</h2>
                        <button class="close-btn" onclick="closeM(this)">√ó</button>
                    </div>
                    <div class="dialog-body">${content}</div>
                </div>
            `

            document.body.appendChild(m)
            document.body.style.overflow = 'hidden'
            setTimeout(() => m.classList.add('show'), 10)

            m.addEventListener('click', e => {
                if (e.target === m) closeM(m.querySelector('.close-btn'))
            })

            return m
        }

        function closeM(btn) {
            const m = btn.closest('.overlay')
            m.classList.remove('show')
            document.body.style.overflow = ''
            setTimeout(() => m.remove(), 300)
        }

        function closeModals() {
            document.querySelectorAll('.overlay').forEach(m => {
                m.classList.remove('show')
                document.body.style.overflow = ''
                setTimeout(() => m.remove(), 300)
            })
        }

        async function logout() {
            try {
                await fetch(`${API_BASE}/auth/logout`, {method: 'POST', credentials: 'include'})
                APP_STATE.currentUser = null
                APP_STATE.isLoggedIn = false
                updateUI()
                toast('Logout realizado', 'success')
            } catch (err) {
                console.error(err)
            }
        }

        function toast(msg, type='success') {
            const wrap = document.getElementById('toastWrap')
            const t = document.createElement('div')
            t.className = `toast ${type}`
            t.textContent = msg
            wrap.appendChild(t)

            setTimeout(() => {
                t.style.opacity = '0'
                t.style.transform = window.innerWidth < 640 ? 'translateY(100px)' : 'translateX(400px)'
                setTimeout(() => t.remove(), 300)
            }, 3500)
        }

        window.addEventListener('DOMContentLoaded', () => {
            checkAuth().then(() => loadVehicles())
        })
    </script>
</body>
</html>
